/*!
 Rosso.js - minimal client-side JS framework
 (C) 2014 Alessandro Segala.
 Based on page.js, (C) 2012 TJ Holowaychuk <tj@vision-media.ca>.
 License: MIT
 
 Includes path-to-js.
 Copyright (c) 2014 Blake Embrey (hello@blakeembrey.com).
 License: MIT
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Rosso=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function d(a,b){return a.keys=b,a}function e(a,b,h){f(b)||(h=b,b=null),b=b||[],h=h||{};var i=h.strict,j=h.end!==!1,k=h.sensitive?"":"i",l=0;if(a instanceof RegExp){var m=a.source.match(/\((?!\?)/g);if(m)for(var n=0;n<m.length;n++)b.push({name:n,delimiter:null,optional:!1,repeat:!1});return d(a,b)}if(f(a)){for(var o=[],n=0;n<a.length;n++)o.push(e(a[n],b,h).source);return d(new RegExp("(?:"+o.join("|")+")",k),b)}a=a.replace(g,function(a,d,e,f,g,h,i,j){if(d)return d;if(j)return"\\"+j;var k="+"===i||"*"===i,m="?"===i||"*"===i;return b.push({name:f||l++,delimiter:e||"/",optional:m,repeat:k}),e=e?"\\"+e:"",g=c(g||h||"[^"+(e||"\\/")+"]+?"),k&&(g=g+"(?:"+e+g+")*"),m?"(?:"+e+"("+g+"))?":e+"("+g+")"});var p="/"===a[a.length-1];return i||(a=(p?a.slice(0,-2):a)+"(?:\\/(?=$))?"),j||(a+=i&&p?"":"(?=\\/|$)"),d(new RegExp("^"+a+(j?"$":""),k),b)}var f=a("isarray");b.exports=e;var g=new RegExp(["(\\\\.)","([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?","([.+*?=^!:${}()[\\]|\\/])"].join("|"),"g")},{isarray:2}],2:[function(a,b){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],3:[function(a,b){"use strict";function c(a){var b=a.indexOf("?");if(this.path=a,this.querystring=-1!==b?a.slice(b+1):"",this.pathname=-1!==b?a.slice(0,b):a,this.params=[],this.querystringParams={},this.querystring){var c=this.querystring.split("&");for(var d in c){var e=c[d].split("=").map(decodeURIComponent);this.querystringParams[e[0]]=e[1]}}}b&&(b.exports=c)},{}],4:[function(a,b){"use strict";function c(a,b){if("object"==typeof b){var d=new e(a,b);c.routes.push(d)}else"string"==typeof a?c.show(a):c.init(a)}function d(){c.show(c.getPath())}var e=a("./Route.js"),f=a("./Context.js"),g=!1,h={container:""},i=!1;c.routes=[],c.middlewares={},c.middleware=function(a,b){c.middlewares[a]=b},c.setOption=function(a,b){h[a]=b},c.getOption=function(a){return h[a]},c.init=function(a){for(var b in a)this.setOption(b,a[b]);g||(g=!0,window.addEventListener("hashchange",d,!1),d())},c.deinit=function(){g=!1,window.removeEventListener("hashchange",d,!1)},c.push=function(a){g&&("#"==a.substr(0,1)&&(a=a.substr(1)),window.location.hash="#"+a)},c.pop=function(){g&&window.history.back()},c.replace=function(a){g&&("#"==a.substr(0,1)&&(a=a.substr(1)),window.history&&history.replaceState?(history.replaceState(void 0,void 0,"#"+a),d()):location.replace("#"+a))},c.getPath=function(){if(window.location.href.indexOf("#")>-1){var a=window.location.href.split("#");return a[a.length-1]}return""},c.currentPage=function(){return i.args},c.show=function(a){"#"==a.substr(0,1)&&(a=a.substr(1)),i&&(c.unloadPage(i),i=!1),a||(a="");for(var b=new f(a),d=0;d<c.routes.length;d++){var e=c.routes[d];if(e.match(b.path,b.params)){c.loadPage(e.args,b,function(){i=e});break}}return b},c.loadPage=function(a,b,d){var e=a.middlewares?a.middlewares.slice():[],f=function(b,c){if(a.ctx=b,a.view&&h.container){var d=!1;if("object"==typeof h.container&&h.container.nodeName?d=h.container:"string"==typeof h.container&&(d=document.getElementById(h.container)),"string"==typeof a.view&&"#"==a.view[0]){var e=document.getElementById(a.view.substr(1));if(e&&d){var f=e.innerHTML;d.innerHTML=f}}else if("function"==typeof a.view){var f=a.view(b);d&&(d.innerHTML=f)}}a.init&&a.init(b,c)};e.push(f);var g=function(a,b){b(!0)},i=function(a){if(a)return d(!1);var f=e.shift();f?("string"==typeof f&&(f=c.middlewares[f]?c.middlewares[f].init:!1,f||(f=g)),f(b,i)):d(!0)};return i(),!0},c.unloadPage=function(a){a.args.ctx&&delete a.args.ctx,a.args.destroy&&a.args.destroy()},b&&(b.exports=c),window.Rosso=c},{"./Context.js":3,"./Route.js":5}],5:[function(a,b){"use strict";function c(a,b,c){c=c||{},this.path="*"===a?"(.*)":a,this.regexp=d(this.path,this.keys=[],c.sensitive,c.strict),this.args=b}var d=a("path-to-regexp");c.prototype.getArgs=function(){return this.args?this.args:{}},c.prototype.setArgs=function(a){this.args=a},c.prototype.match=function(a,b){var c=this.keys,d=a.indexOf("?"),e=-1!==d?a.slice(0,d):a,f=this.regexp.exec(decodeURIComponent(e));if(!f)return!1;for(var g=1,h=f.length;h>g;++g){var i=c[g-1],j="string"==typeof f[g]?decodeURIComponent(f[g]):f[g];i?b[i.name]=void 0!==b[i.name]?b[i.name]:j:b.push(j)}return!0},b.exports=c},{"path-to-regexp":1}]},{},[4])(4)});